<!-- lint ignore maximum-heading-length -->
# A Specification for Machine-Readable Output for JSON Schema Validation and Annotation

JSON Schema is defined to be platform-independent. As such, to increase
compatibility across platforms, implementations SHOULD conform to a standard
validation output format. This specification describes a number of output
formats intended for machine consumers.

## Table of Contents

## Schema Identifiers

The output defined in this specification requires that an initial IRI is defined
per [JSON Schema Core](./json-schema-core#initial-base) "Initial Base IRI" with an
[absolute IRI](#rfc3987). In the event an absolute IRI has not been defined, the
implementation MUST generate one.

## Textual Format and Encoding

JSON Schema output is defined using the JSON Schema data instance model as
described in [JSON Schema Core](./jsonschema-core#data-model) "Instance Data
Model". Implementations MAY deviate from this in their internal modelling, as
supported by their specific languages and platforms, however it is RECOMMENDED
that the output be convertible to the JSON format defined herein via
serialization or other means.

## The Output Object

The output of a subschema validation is a JSON object which contains general
information about the validation as well as a set of
[output units](#output-unit) which contain specifics.

The root object MUST contain the following properties:

| Property | Value |
|:-|:-|
| `dialect` | The `$schema` IRI of the evaluating schema. |
| `schema` | The identifier `$id` or otherwise used to identify the evaluating schema. |
| `valid` | A boolean indicating the overall validation result. |

For the "list" and "hierarchical" formats, the following is also required:

| `details` | A collection of output units to provide additional details. Must be an array, even when containing a single output unit. |

### Output Unit {#output-unit}

An output unit describes the evaluation of a single subschema against the appropriate instance location.

Each output unit MUST contain the [validation result](#validation-result) for
the associated subschema as well as the following information defined by
[JSON Schema](./jsonschema-core#output) "Output Formatting":

- Evaluation Path (as `evaluationPath`)
- Schema Location (as `schemaLocation`)
- Instance Location (as `instanceLocation`)

The following information MAY be included conditionally:

- When subschema validation has succeeded
  - Annotations (as `annotations`)
- When subschema validation has failed
  - Errors (as `errors`)
  - Dropped Annotations (as `droppedAnnotations`)

When including this information, the indicated property names MUST be used.

Implementations MAY elect to provide additional information.

#### Validation Result {#validation-result}

The validation result is a boolean that indicates whether the local instance
passed validation by the local subschema.

The JSON key for these additional results is `valid`.

#### Results from Subschemas

Similar to the root object's `details` property, this property contains
evaluation results generated by applying a subschema to the instance or a child
of the instance. Keywords which have multiple subschemas (e.g. `anyOf`) will
generally generate an output unit for each subschema. In order to accommodate
potentially multiple results, the value of this property MUST be an array of
output units, even if only a single output unit is produced.

This property of the output unit is only used for the "hierarchical" format and
will contain results in a tree structure where each output unit may itself have
further nested results.

The sequence of output units within this list is not specified and MAY be
determined by the implementation. Sets of output units are considered equivalent
if they contain the same units, in any order.

<!-- Not sure if it's necessary to mention equivalence. -->

The JSON key for these additional results is `details`.

## Output Structure {#output-structure}

This specification defines three output formats.

- **Flag** - A boolean which simply indicates the overall validation result with
  no further details.
- **List** - Provides validation information in a flat list structure.
- **Hierarchical** - Provides validation information in a hierarchical structure
  that follows the evaluation paths generated while processing the schema.

An implementation MUST provide the "flag" format and SHOULD provide at least one
of the "list" or "hierarchical" formats. Implementations SHOULD specify in their
documentation which formats they support.

For these examples, the following schema and instances will be used.

```jsonschema "Example Schema"
{
  "$schema": "https://json-schema.org/draft/next/schema",
  "$id": "https://json-schema.org/schemas/example",
  "type": "object",
  "title": "root",
  "properties": {
    "foo": {
      "allOf": [
        { "required": ["unspecified-prop"] },
        {
          "type": "object",
          "title": "foo-title",
          "properties": {
            "foo-prop": {
              "const": 1,
              "title": "foo-prop-title"
            }
          },
          "additionalProperties": { "type": "boolean" }
        }
      ]
    },
    "bar": { "$ref": "#/$defs/bar" }
  },
  "$defs": {
    "bar": {
      "type": "object",
      "title": "bar-title",
      "properties": {
        "bar-prop": {
          "type": "integer",
          "minimum": 10,
          "title": "bar-prop-title"
        }
      }
    }
  }
}
```

```json "Failing Instance"
{
  "foo": { "foo-prop": "not 1", "other-prop": false },
  "bar": { "bar-prop": 2 }
}
```

```json "Passing Instance"
{
  "foo": {
    "foo-prop": 1,
    "unspecified-prop": true
  },
  "bar": { "bar-prop": 20 }
}
```

The failing instance will produce the following errors:

- The instance value at `/foo`
  evaluated at `/properties/foo/allOf/0`
  by following the path `/properties/foo/allOf/0`
  by the `required` keyword
  is missing the property `unspecified-prop`.
- The value at `/foo/foo-prop`
  evaluated at `/properties/foo/allOf/1/properties/foo-prop`
  by following the path `/properties/foo/allOf/1/properties/foo-prop`
  by the `const` keyword
  is not the constant value 1.
- The value at `/bar/bar-prop`
  evaluated at `/$defs/bar/properties/bar-prop`
  by following the path `/properties/bar/$ref/properties/bar-prop`
  by the `type` keyword
  is not a number.

<!--
"minimum" doesn't produce an error because it only operates on instances that
are numbers.
-->
<!--
Note that the error message wording as depicted in the examples below is not a
requirement of this specification. Implementations SHOULD craft error messages
tailored for their audience or provide a templating mechanism that allows their
users to craft their own messages.
-->

The passing instance will produce the following annotations:

- The keyword `title`
  evaluated at ``
  by following the path ``
  will produce `"root"`.
- The keyword `properties`
  evaluated at ``
  by following the path ``
  will produce `["foo", "bar"]`.
- The keyword `title`
  evaluated at `/properties/foo`
  by following the path `/properties/foo`
  will produce `"foo-title"`.
- The keyword `properties`
  evaluated at `/properties/foo/allOf/1`
  by following the path `/properties/foo/allOf/1`
  will produce `["foo-prop"]`.
- The keyword `additionalProperties`
  evaluated at `/properties/foo/allOf/1`
  by following the path `/properties/foo/allOf/1`
  will produce `["unspecified-prop"]`.
- The keyword `title`
  evaluated at `/properties/foo/allOf/1/properties/foo-prop`
  by following the path `/properties/foo/allOf/1/properties/foo-prop`
  will produce `"foo-prop-title"`.
- The keyword `title`
  evaluated at `/$defs/bar`
  by following the path `/properties/bar/$ref`
  will produce `"bar-title"`.
- The keyword `properties`
  evaluated at `/$defs/bar`
  by following the path `/properties/var/$ref`
  will produce `["bar-prop"]`.
- The keyword `title`
  evaluated at `/$defs/bar/properties/bar-prop`
  by following the path `/properties/bar/$ref/properties/bar-prop`
  will produce `"bar-prop-title"`.

### Flag

In the simplest case, merely the boolean result for the `valid` valid property
needs to be fulfilled. For this format, all other information is explicitly
omitted.

```json "Flag Results"
{
  "dialect": "https://json-schema.org/draft/next/schema",
  "schema": "https://json-schema.org/schemas/example",
  "valid": false
}
```

Because no errors or annotations are returned with this format, it is
RECOMMENDED that implementations use short-circuiting logic to return failure or
success as soon as the outcome can be determined. For example, if an `anyOf`
keyword contains five subschemas, and the second one passes, there is no need to
check the other three. The logic can simply return with success.

### List

The "list" structure is a flat list of output units contained within the root
object's `details` array.

Output units which do not contain errors or annotations SHOULD be excluded from
this format, however implementations MAY choose to include them for
completeness.

```json "Failing Results"
{
  "dialect": "https://json-schema.org/draft/next/schema",
  "schema": "https://json-schema.org/schemas/example",
  "valid": false,
  "details": [
    {
      "valid": false,
      "evaluationPath": "/properties/foo/allOf/0",
      "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/0",
      "instanceLocation": "/foo",
      "errors": {
        "required": "Required properties [\"unspecified-prop\"] were not present"
      }
    },
    {
      "valid": false,
      "evaluationPath": "/properties/foo/allOf/1/properties/foo-prop",
      "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1/properties/foo-prop",
      "instanceLocation": "/foo/foo-prop",
      "errors": {
        "const": "Expected \"1\""
      }
    },
    {
      "valid": false,
      "evaluationPath": "/properties/bar/$ref/properties/bar-prop",
      "schemaLocation": "https://json-schema.org/schemas/example#/$defs/bar/properties/bar-prop",
      "instanceLocation": "/bar/bar-prop",
      "errors": {
        "minimum": "2 is less than or equal to 10"
      }
    }
  ]
}
```

```json "Passing Results"
{
  "dialect": "https://json-schema.org/draft/next/schema",
  "schema": "https://json-schema.org/schemas/example",
  "valid": true,
  "details": [
    {
      "valid": true,
      "evaluationPath": "",
      "schemaLocation": "https://json-schema.org/schemas/example#",
      "instanceLocation": "",
      "annotations": {
        "title": "root",
        "properties": [
          "foo",
          "bar"
        ]
      }
    },
    {
      "valid": true,
      "evaluationPath": "/properties/foo/allOf/1",
      "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1",
      "instanceLocation": "/foo",
      "annotations": {
        "title": "foo-title",
        "properties": [
          "foo-prop"
        ],
        "additionalProperties": [
          "unspecified-prop"
        ]
      }
    },
    {
      "valid": true,
      "evaluationPath": "/properties/bar/$ref",
      "schemaLocation": "https://json-schema.org/schemas/example#/$defs/bar",
      "instanceLocation": "/bar",
      "annotations": {
        "title": "bar-title",
        "properties": [
          "bar-prop"
        ]
      }
    },
    {
      "valid": true,
      "evaluationPath": "/properties/foo/allOf/1/properties/foo-prop",
      "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1/properties/foo-prop",
      "instanceLocation": "/foo/foo-prop",
      "annotations": {
        "title": "foo-prop-title"
      }
    },
    {
      "valid": true,
      "evaluationPath": "/properties/bar/$ref/properties/bar-prop",
      "schemaLocation": "https://json-schema.org/schemas/example#/$defs/bar/properties/bar-prop",
      "instanceLocation": "/bar/bar-prop",
      "annotations": {
        "title": "bar-prop-title"
      }
    }
  ]
}
```

### Hierarchical

The "Hierarchical" structure is a tree structure that follows the evaluation
path during the validation process. Typically, it will resemble the schema as if
all referenced schemas were inlined in place of their associated by-reference
keywords.

All output units are included in this format.

The location properties of the root output unit MAY be omitted.

```json "failing Results
{
  "dialect": "https://json-schema.org/draft/next/schema",
  "schema": "https://json-schema.org/schemas/example",
  "valid": false,
  "details": [
    {
      "valid": false,
      "evaluationPath": "",
      "schemaLocation": "https://json-schema.org/schemas/example#",
      "instanceLocation": "",
      "details": [
        {
          "valid": false,
          "evaluationPath": "/properties/foo",
          "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo",
          "instanceLocation": "/foo",
          "details": [
            {
              "valid": false,
              "evaluationPath": "/properties/foo/allOf/0",
              "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/0",
              "instanceLocation": "/foo",
              "errors": {
                "required": "Required properties [\"unspecified-prop\"] were not present"
              }
            },
            {
              "valid": false,
              "evaluationPath": "/properties/foo/allOf/1",
              "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1",
              "instanceLocation": "/foo",
              "droppedAnnotations": {
                "properties": [ "foo-prop" ],
                "title": "foo-title"
              },
              "details": [
                {
                  "valid": false,
                  "evaluationPath": "/properties/foo/allOf/1/properties/foo-prop",
                  "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1/properties/foo-prop",
                  "instanceLocation": "/foo/foo-prop",
                  "errors": {
                    "const": "Expected \"1\""
                  },
                  "droppedAnnotations": {
                    "title": "foo-prop-title"
                  }
                },
                {
                  "valid": true,
                  "evaluationPath": "/properties/foo/allOf/1/additionalProperties",
                  "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1/additionalProperties",
                  "instanceLocation": "/foo/other-prop"
                }
              ]
            }
          ]
        },
        {
          "valid": false,
          "evaluationPath": "/properties/bar",
          "schemaLocation": "https://json-schema.org/schemas/example#/properties/bar",
          "instanceLocation": "/bar",
          "details": [
            {
              "valid": false,
              "evaluationPath": "/properties/bar/$ref",
              "schemaLocation": "https://json-schema.org/schemas/example#/$defs/bar",
              "instanceLocation": "/bar",
              "droppedAnnotations": {
                "properties": [ "bar-prop" ],
                "title": "bar-title"
              },
              "details": [
                {
                  "valid": false,
                  "evaluationPath": "/properties/bar/$ref/properties/bar-prop",
                  "schemaLocation": "https://json-schema.org/schemas/example#/$defs/bar/properties/bar-prop",
                  "instanceLocation": "/bar/bar-prop",
                  "errors": {
                    "minimum": "2 is less than or equal to 10"
                  },
                  "droppedAnnotations": {
                    "title": "bar-prop-title"
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}

```

```json "Passing Results
{
  "dialect": "https://json-schema.org/draft/next/schema",
  "schema": "https://json-schema.org/schemas/example",
  "valid": false,
  "details": [
    {
      "valid": true,
      "evaluationPath": "",
      "schemaLocation": "https://json-schema.org/schemas/example#",
      "instanceLocation": "",
      "annotations": {
        "title": "root",
        "properties": [
          "foo",
          "bar"
        ]
      },
      "details": [
        {
          "valid": true,
          "evaluationPath": "/properties/foo",
          "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo",
          "instanceLocation": "/foo",
          "details": [
            {
              "valid": true,
              "evaluationPath": "/properties/foo/allOf/0",
              "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/0",
              "instanceLocation": "/foo"
            },
            {
              "valid": true,
              "evaluationPath": "/properties/foo/allOf/1",
              "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1",
              "instanceLocation": "/foo",
              "annotations": {
                "title": "foo-title",
                "properties": [
                  "foo-prop"
                ],
                "additionalProperties": [
                  "unspecified-prop"
                ]
              },
              "details": [
                {
                  "valid": true,
                  "evaluationPath": "/properties/foo/allOf/1/properties/foo-prop",
                  "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1/properties/foo-prop",
                  "instanceLocation": "/foo/foo-prop",
                  "annotations": {
                    "title": "foo-prop-title"
                  }
                },
                {
                  "valid": true,
                  "evaluationPath": "/properties/foo/allOf/1/additionalProperties",
                  "schemaLocation": "https://json-schema.org/schemas/example#/properties/foo/allOf/1/additionalProperties",
                  "instanceLocation": "/foo/unspecified-prop"
                }
              ]
            }
          ]
        },
        {
          "valid": true,
          "evaluationPath": "/properties/bar",
          "schemaLocation": "https://json-schema.org/schemas/example#/properties/bar",
          "instanceLocation": "/bar",
          "details": [
            {
              "valid": true,
              "evaluationPath": "/properties/bar/$ref",
              "schemaLocation": "https://json-schema.org/schemas/example#/$defs/bar",
              "instanceLocation": "/bar",
              "annotations": {
                "title": "bar-title",
                "properties": [
                  "bar-prop"
                ]
              },
              "details": [
                {
                  "valid": true,
                  "evaluationPath": "/properties/bar/$ref/properties/bar-prop",
                  "schemaLocation": "https://json-schema.org/schemas/example#/$defs/bar/properties/bar-prop",
                  "instanceLocation": "/bar/bar-prop",
                  "annotations": {
                    "title": "bar-prop-title"
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

## Output validation schemas

For convenience, JSON Schema has been provided to validate output generated by
implementations. Its IRI is: <https://json-schema.org/draft/next/output/schema>
and can also be found at this address.

## Filtering

For various reasons, including human readability and performance during
evaluation, a user may desire to omit certain details from the output. To
address this, implementations MAY provide filtering output information.

This section defines several RECOMMENDED approaches to filtering, however
implementations MAY choose to provide these features in a way that suits them
and their users best.

For those implementations which support filtering behaviors, the behaviors MUST
be configurable and disabled by default.

### Annotation Filtering

Collecting and storing annotations can require increasing amounts of system
resources as evaluation proceeds. The strain on systems can be reduced by only
collecting those annotations which users care about.

For annotation filtering, implementations SHOULD provide a mechanism which
allows users to configure either the set annotations they would like to keep or
the set they would like to ignore.

For a "keep" list, an implementation MUST include in the output only those
annotations which are configured.

For an "ignore" list, an implementation MUST NOT include in the output those
annotations which are configured.

#### Annotations Required for Evaluation

Some implementations may be annotation-driven. That is, the evaluation of some
keywords depends on the annotation results of other keywords. For example, which
properties are seen by `additionalProperties` can be determined by looking at
the annotation results of `properties` and `patternProperties`.

For these implementations, the annotation results of these dependent keywords
must still be collected for proper evaluation. However, these annotations MUST
NOT be included in the output unless they are configured accordingly.

### Output Unit Pruning

In many cases, the output structures defined herein produce output units for
more than is necessary to identify evaluation issues. Implementations SHOULD
provide a mechanism which removes unimportant output units from the final
structure in order to highlight those units which impact the final result.

Reasons to omit output units may include, but are not limited to:

- Child output units whose validation result does not impact the validation
  result of the parent. For example, a subschema of an `anyOf` which has a false
  validation result when there exists a sibling subschema with a true validation
  result.
- Child output units which have a true validation result but contain no
  annotations.

Output units which include annotations MUST NOT be pruned.

Implementations which provide this behavior SHOULD provide configuration
mechanisms appropriate for their users' needs.

## References

### Normative References

#### \[RFC2119\] {#rfc2119}

Bradner, S., "Key words for use in RFCs to Indicate Requirement Levels", BCP 14,
RFC 2119, DOI 10.17487/RFC2119, March 1997,
<<https://www.rfc-editor.org/info/rfc2119>>.

#### \[RFC3986\] {#rfc3986}

Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform Resource Identifier
(URI): Generic Syntax", STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005,
<<https://www.rfc-editor.org/info/rfc3986>>.

#### \[RFC3987\] {#rfc3987}

Duerst, M. and M. Suignard, "Internationalized Resource Identifiers (IRIs)", RFC
3987, DOI 10.17487/RFC3987, January 2005,
<<https://www.rfc-editor.org/info/rfc3987>>.

#### \[RFC6901\] {#rfc6901}

Bryan, P., Ed., Zyp, K., and M. Nottingham, Ed., "JavaScript Object Notation
(JSON) Pointer", RFC 6901, DOI 10.17487/RFC6901, April 2013,
<<https://www.rfc-editor.org/info/rfc6901>>.

#### \[RFC8259\] {#rfc8259}

Bray, T., Ed., "The JavaScript Object Notation (JSON) Data Interchange Format",
STD 90, RFC 8259, DOI 10.17487/RFC8259, December 2017,
<<https://www.rfc-editor.org/info/rfc8259>>.

#### \[json-schema\] {#json-schema}

Wright, A., Andrews, H., Hutton, B., and G. Dennis, "JSON Schema: A Media Type
for Describing JSON Documents", Work in Progress, Internet-Draft,
draft-bhutton-json-schema-01, June 2022,
<<https://datatracker.ietf.org/doc/html/draft-bhutton-json-schema-01>>.
